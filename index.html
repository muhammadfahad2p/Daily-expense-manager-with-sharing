<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Expense Manager</title>
<link rel="stylesheet" href="style.css">
<script src="https://accounts.google.com/gsi/client" async defer></script>
<script src="https://apis.google.com/js/api.js" async defer></script>
</head>
<body>

<header>
  <h1>Expense Manager</h1>
  <div id="headerTotal">SR 0.00</div>
</header>

<nav>
  <button id="btnList" class="nav-item active" onclick="switchView('list')">List</button>
  <button id="btnSum" class="nav-item" onclick="switchView('summary')">Summary</button>
  <button id="btnSet" class="nav-item" onclick="switchView('settings')">Settings</button>
</nav>

<!-- ===================== LIST VIEW ===================== -->
<section id="viewList" class="view-section active">
  <div>
    <input type="text" id="searchInput" placeholder="Search..." oninput="renderList()">
    <select id="searchType" onchange="renderList()">
      <option value="all">All</option>
      <option value="item">Item</option>
      <option value="paid">Paid By</option>
      <option value="consumed">Consumed By</option>
      <option value="price">Price</option>
    </select>
    <button onclick="openEntryModal()">+ Add Expense</button>
    <button onclick="openExportModal()">Export</button>
  </div>
  <div id="listContainer"></div>
</section>

<!-- ===================== SUMMARY VIEW ===================== -->
<section id="viewSummary" class="view-section">
  <div>
    <button onclick="openDateModal()">Select Date Range</button>
    <button onclick="resetDates()">Reset</button>
    <span id="currentRangeDisplay">All Time</span>
  </div>
  <div id="paidArea"></div>
  <div id="consumedArea"></div>
  <div id="settlementArea"></div>
</section>

<!-- ===================== SETTINGS / GOOGLE DRIVE ===================== -->
<section id="viewSettings" class="view-section">
  <h2>Google Drive Backup / Restore</h2>
  <div id="syncStatus">Loading...</div>
  <div id="driveControls">
    <button onclick="loginDrive()">Connect Google Drive</button>
  </div>
  <div id="driveActions" class="hidden">
    <button onclick="backupToDrive()">Backup to Drive</button>
    <button onclick="restoreFromDrive()">Restore from Drive</button>
  </div>
  <hr>
  <h3>Local Data</h3>
  <button onclick="clearAllData()">Delete All Local Data</button>
</section>

<!-- ===================== ENTRY MODAL ===================== -->
<div id="modalEntry" class="modal">
  <div class="modal-content">
    <h3 id="modalTitle">Add Expense</h3>
    <input type="hidden" id="entryId">
    <label>Date:</label><input type="datetime-local" id="inpDate">
    <label>Item:</label><input type="text" id="inpItem">
    <label>Price:</label><input type="number" id="inpPrice" step="0.01">
    <label>Paid By:</label><input type="text" id="inpPaid" list="namesList">
    <label>Consumed By:</label><input type="text" id="inpConsumed" list="namesList">
    <label>Description:</label><textarea id="inpDesc"></textarea>
    <datalist id="namesList"></datalist>
    <div id="editTools" class="hidden">
      <button onclick="deleteEntry()">Delete</button>
      <button onclick="finishCopy()">Copy</button>
    </div>
    <button onclick="saveEntry()">Save</button>
    <button onclick="closeModal('modalEntry')">Cancel</button>
  </div>
</div>

<!-- ===================== DATE MODAL ===================== -->
<div id="modalDateFilter" class="modal">
  <div class="modal-content">
    <h3>Select Date Range</h3>
    <label>Start:</label><input type="date" id="sumStart">
    <label>End:</label><input type="date" id="sumEnd">
    <button onclick="applyDateFilter()">Apply</button>
    <button onclick="closeModal('modalDateFilter')">Cancel</button>
  </div>
</div>

<!-- ===================== EXPORT MODAL ===================== -->
<div id="modalExport" class="modal">
  <div class="modal-content">
    <h3>Export CSV</h3>
    <label>Start:</label><input type="date" id="expStart">
    <label>End:</label><input type="date" id="expEnd">
    <button onclick="executeExport('download')">Download</button>
    <button onclick="executeExport('share')">Share</button>
    <button onclick="closeModal('modalExport')">Cancel</button>
  </div>
</div>

<script src="script.js"></script>
</body>
</html>
